---
title: Inside PHP&colon; ë°°ê²½ì§€ì‹ & í™˜ê²½ì„¤ì • (Part 1)
description: php 7.4.33 ~ 8.4.4(latest)
author: goldleo1
date: 2025-03-09 00:00:00 +0800
categories: [cheatsheet]
tags: [web, php, rce, inside php]
pin: false
draft: true
---

## Before You Begin to Read

ì´ ê¸€ì€ í•´í‚¹ì„ ê³µë¶€í•˜ê¸° ìœ„í•´ ì‘ì„±í•˜ëŠ” ê¸€ë¡œ ì•„ì§ ë¯¸í¡í•œ ë¶€ë¶„ì´ ë§ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

ë§Œì•½ ê°œë…ì´ë‚˜ ì„¤ëª… ë“±ì—ì„œ ì˜¤ë¥˜ë¥¼ ë°œê²¬í•˜ì…¨ë‹¤ë©´ ì €ì—ê²Œ ì•Œë ¤ì£¼ì‹œë©´ ê¸°ì˜ê²Œ í”¼ë“œë°± ë°›ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

`Inside PHP` ì‹œë¦¬ì¦ˆëŠ” munsiwooë‹˜ì´ 2019 Codegateì—ì„œ ë°œí‘œí•˜ì‹  [PHP Trick Trip](https://github.com/munsiwoo/PHP-Trick-Trip)ì˜ ê°œë…ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ì‹œì‘í•˜ì—¬ 
Zend Engineì˜ ë™ì‘ë¶€í„° phpì™€ apacheì˜ misconfigureì—ì„œ ë°œìƒí•˜ëŠ” ì·¨ì•½ì , phpì—ì„œë§Œ ë°œìƒí•˜ëŠ” íŠ¹ë³„í•œ trick ë“±ì„ 
CTF & Real-Worldë¥¼ í†µí•œ Case-Studyë¥¼ í†µí•´ ì•Œì•„ë³´ë©° ë‹¤ì–‘í•œ ë‚´ìš©ë“¤ì„ ë‹¤ë£°(ê³µë¶€í• ) ì˜ˆì •ì…ë‹ˆë‹¤.

> ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!

## What is PHP?

PHP(PHP: Hypertext Preprocessor)ëŠ” ë²”ìš© í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë‹¤.
ë™ì  ì›¹ í˜ì´ì§€ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ì„¤ê³„ë˜ì—ˆìœ¼ë©° PHPë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ PHP ì—”ì§„ì—ì„œ html íŒŒì¼ê³¼ ê°™ì´ ì²˜ë¦¬í•˜ì—¬ ì‘ì„±ìê°€ ì›í•˜ëŠ” ì›¹ í˜ì´ì§€ë¥¼ ìƒì„±í•œë‹¤.

2015ë…„ PHP 7.0ì´í›„ì—ëŠ” PHP ì½”ë“œì™€ HTMLì„ ë³„ë„ íŒŒì¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ì‘ì„±í•˜ëŠ” ê²½ìš°ê°€ ì¼ë°˜ì ì´ë©°, PHP ë˜í•œ ì›¹ì„œë²„ê°€ ì•„ë‹Œ php-fpm(PHP FastCGI Process Manager)ì„ í†µí•´ ì‹¤í–‰í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤.
[^1]

![alt text](assets/img/2025-03-09 01-49-44.png)

[tiobe.com](tiobe.com)ì— ë”°ë¥´ë©´ phpëŠ” 2000ë…„ëŒ€ ì´ˆë°˜ì— ë§ì€ ì¸ê¸°ë¥¼ ëŒë‹¤ê°€ ì´í›„ ì ì  ì¸ê¸°ê°€ í•˜ë½í•˜ê³  ìˆëŠ” ì–¸ì–´ì´ë‹¤.

~~(íƒœì–´ë‚˜ê¸° ì „ì´ë¼ ì‚¬ì‹¤ ì˜ ëª¨ë¥´ê² ë‹¤)~~

í”„ë¡ íŠ¸ì™€ ë°±ì„ í•˜ë‚˜ì˜ íŒŒì¼ì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ ì¥ì ì´ì ë‹¨ì ìœ¼ë¡œ ìƒê°ë˜ëŠ” ê²ƒ ê°™ë‹¤.

ì‚¬ìš©ë¥ ì´ ì¤„ê³ ëŠ” ìˆì§€ë§Œ í”„ë¡ íŠ¸ì—”ë“œ íŒŒì¼ì˜ í™•ì¥ìë¥¼ `.php`ë¡œë§Œ ë°”ê¾¸ê³  ê°„ë‹¨í•œ ë°±ì—”ë“œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì‘ì€ í”„ë¡œì íŠ¸ì—ë„ ë§ì´ ì‚¬ìš©ëœë‹¤.

phpë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ëŠ” [ì›Œë“œí”„ë ˆìŠ¤](https://ko.wikipedia.org/wiki/ì›Œë“œí”„ë ˆìŠ¤), [ë¯¸ë””ì–´ìœ„í‚¤](https://ko.wikipedia.org/wiki/ë¯¸ë””ì–´ìœ„í‚¤) ë“±ì´ ìˆê³ , êµ­ë‚´ì—ëŠ” [ê·¸ëˆ„ë³´ë“œ](https://ko.wikipedia.org/wiki/ê·¸ëˆ„ë³´ë“œ) ë“±ì´ ìˆë‹¤.

## How to use PHP?

---

ChatGPTì„ ìƒë‹˜ì˜ ë„ì›€ì„ í†µí•´ í•œë²ˆ ì•Œì•„ë³´ì•˜ë‹¤.

| í•­ëª©          | Apache | Nginx | CGI | FastCGI | PHP-FPM |
|--------------|--------|-------|-----|---------|---------|
| **ì—­í• **      | ì›¹ ì„œë²„ | ì›¹ ì„œë²„ | PHP ì‹¤í–‰ ë°©ì‹ | PHP ì‹¤í–‰ ë°©ì‹ | PHP ì‹¤í–‰ ë°©ì‹ |
| **PHP ì‹¤í–‰ ì§€ì›** | mod_php, CGI, FastCGI, PHP-FPM | PHP-FPM í•„ìš” | ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ ìƒì„± | í”„ë¡œì„¸ìŠ¤ë¥¼ ìœ ì§€í•˜ë©° ì—¬ëŸ¬ ìš”ì²­ ì²˜ë¦¬ | FastCGI ê¸°ë°˜ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™” |
| **ì„±ëŠ¥** | ë³´í†µ (ë©€í‹° í”„ë¡œì„¸ìŠ¤ ê¸°ë°˜) | ë†’ìŒ (ë¹„ë™ê¸° ì²˜ë¦¬) | ë‚®ìŒ (ë§¤ ìš”ì²­ë§ˆë‹¤ í”„ë¡œì„¸ìŠ¤ ìƒì„±) | ë†’ìŒ (í”„ë¡œì„¸ìŠ¤ ì¬ì‚¬ìš©) | ë§¤ìš° ë†’ìŒ (FastCGI ìµœì í™”) |
| **ë™ì‹œ ìš”ì²­ ì²˜ë¦¬** | ìƒëŒ€ì ìœ¼ë¡œ ë‚®ìŒ | ë§¤ìš° ë†’ìŒ | ë‚®ìŒ | ë†’ìŒ | ë§¤ìš° ë†’ìŒ |
| **ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰** | ë†’ìŒ (í”„ë¡œì„¸ìŠ¤ ê°œë³„ ì‹¤í–‰) | ë‚®ìŒ (ë¹„ë™ê¸° ì´ë²¤íŠ¸ ê¸°ë°˜) | ë§¤ìš° ë†’ìŒ | ë‚®ìŒ | ë‚®ìŒ |
| **ì„¤ì • ìœ ì—°ì„±** | ë†’ìŒ (.htaccess ì§€ì›) | ë‚®ìŒ (.htaccess ì—†ìŒ) | ë‚®ìŒ | ë³´í†µ | ë³´í†µ |
| **ì‚¬ìš© ì‚¬ë¡€** | ì „í†µì ì¸ ì›¹ ì„œë²„, `.htaccess` í•„ìš”í•  ë•Œ | ê³ ì„±ëŠ¥, ì •ì  ì½˜í…ì¸  & PHP-FPM ì¡°í•© | ì´ˆì°½ê¸° PHP ì‹¤í–‰ ë°©ì‹ | FastCGI ë°©ì‹ìœ¼ë¡œ ì„±ëŠ¥ ê°œì„  | PHP ì‹¤í–‰ ìµœì í™” (Nginx ê¸°ë³¸ ë°©ì‹) |

- **Apache**: ì˜¤ë˜ëœ ì „í†µì ì¸ ì›¹ ì„œë²„, `.htaccess` ì§€ì›, mod_php ì‚¬ìš© ê°€ëŠ¥.
- **Nginx**: ê°€ë³ê³  ë¹ ë¥¸ ì›¹ ì„œë²„, PHP ì‹¤í–‰ì„ ìœ„í•´ PHP-FPM í•„ìš”.
- **CGI**: ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ì‹, ì„±ëŠ¥ì´ ë‚®ìŒ.
- **FastCGI**: CGIì˜ ë‹¨ì ì„ ë³´ì™„í•˜ì—¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ìœ ì§€í•˜ë©° ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹.
- **PHP-FPM**: FastCGI ê¸°ë°˜ìœ¼ë¡œ ìµœì í™”ëœ PHP ì‹¤í–‰ ë°©ì‹, **Nginx & Apache**ì—ì„œ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥.

### âœ… ê²°ë¡ 
- **ë†’ì€ ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ ì„±ëŠ¥ì´ í•„ìš”í•œ ê²½ìš°** â†’ `Nginx + PHP-FPM ì¡°í•© ì¶”ì²œ`  
- **.htaccess ì‚¬ìš©ì´ í•„ìš”í•˜ê³ , ê¸°ì¡´ Apache í™˜ê²½ì„ ìœ ì§€í•˜ë ¤ë©´** â†’ `Apache + PHP-FPM ì¶”ì²œ`  
- **ê°€ì¥ ê°„ë‹¨í•˜ê²Œ PHP ì‹¤í–‰ì„ ì›í•œë‹¤ë©´** â†’ `Apache + mod_php ê°€ëŠ¥í•˜ì§€ë§Œ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ë†’ìŒ`

[From ChatGPT](https://chatgpt.com/share/67cd8cf1-0284-800d-81ee-3179eb91894a)

## PHP Versions

ë²„ì „ë³„ í•µì‹¬ ì—…ë°ì´íŠ¸ ì‚¬ì•ˆ ë° CTFê´€ì ì—ì„œ ìì£¼ ë‚˜ì˜¤ëŠ” ì·¨ì•½ì (trick)ì„ ì •ë¦¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

### 5.x

- DBë¥¼ ë‹¤ì–‘í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” PDO(PHP Data Object) ê°œë… ë„ì…
- ë„¤ì„ìŠ¤í˜ì´ìŠ¤, ìµëª…í•¨ìˆ˜
- UTF-8 ê¸°ë³¸ ì¸ì½”ë”©

#### âœ… In the context of CTF
- open_basedir trick?

### 6.x

ë²„ì „ ì—†ìŒ. ë°”ë¡œ 7.0ìœ¼ë¡œ ë°”ë€œ

### 7.x

- AST Parser ì ìš© -> ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ 1/5
- 7.4 í”„ë¦¬ë¡œë”© ë„ì… -> ìµœëŒ€ì„±ëŠ¥ 8% í–¥ìƒ
- í•¨ìˆ˜ ë§¤ê°œë³€ìˆ˜ íƒ€ì… ì§€ì • ê°€ëŠ¥
- null ë³‘í•©ì—°ì‚°ì(`??`) ì§€ì›

#### âœ… In the context of CTF
- very hot ğŸ”¥
- $_GET[] trick
- nginx + php lfi to rce
- phar deserialization
- soap ssrf


### 8.x

- JIT ë„ì…, (Just-in-time), ì˜ˆì™¸ì²˜ë¦¬ ê°•í™”
- @ì—°ì‚°ì ì‚­ì œ
- Null Safe ì—°ì‚°ì ì§€ì› (optional chaining)
- Enum íƒ€ì… ì¶”ê°€
- ê²½ëŸ‰ ìŠ¤ë ˆë”© Fiber ì¶”ê°€


#### âœ… In the context of CTF
- php-cgi cve

## Let's install

ì‚¬ì‹¤ PHP ì„¤ì¹˜ëŠ” ~~ë§¤ìš°~~ ê·€ì°®ìŠµë‹ˆë‹¤.

1. ë²„ì „ê´€ë¦¬
2. apache \| nginx \| php-fpm \| cgi \| mod_php
3. `php.ini`{: .filepath } ì„¤ì •

ê°„ì†Œí™” & ìë™í™”í•˜ê¸° ìœ„í•´ linux(wsl)ì—ì„œ dockerë¥¼ í™œìš©í•˜ì—¬ ì„¤ì¹˜ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

> `<embed>`ë¥¼ ì‚¬ìš©í•´ì„œ ì„ì‹œë°©í¸ìœ¼ë¡œ ì¨ë†¨ëŠ”ë° ë‚˜ì¤‘ì— ìˆ˜ì •í•˜ê² ìŠµë‹ˆë‹¤.

<embed src="/assets/code/inside-php-part-1/" type="text/html" width="800" height="600">

> ëª°ëëŠ”ë° ë¡œì»¬(WEBrick, ë£¨ë¹„)ì—ì„œë§Œ ì‘ë™í•´ì„œ ë‚˜ì¤‘ì— í•˜ê² ìŠµë‹ˆë‹¤.

Reference[^2]

## Let's download source code

```sh
sudo apt update && sudo apt upgrade -y
sudo apt install -y gcc g++ libxml2 libxml2-dev

wget https://museum.php.net/php7/php-7.4.33.tar.gz
tar -xvf php-7.4.33.tar.gz 1> /dev/null

cd php-7.4.33/
./configure --disable-all --enable-debug
make
make install
```

ìµœì‹  ë²„ì „(8.4.4, latest)ê¹Œì§€ëŠ” ì—…ë°ì´íŠ¸ë˜ì–´ìˆì§€ ì•Šì§€ë§Œ í¸í•˜ê²Œ ë˜ì–´ìˆìŠµë‹ˆë‹¤.

## Reference

[^1]: [https://ko.wikipedia.org/wiki/PHP](https://ko.wikipedia.org/wiki/PHP)
[^2]: [https://min-nine.tistory.com/entry/PHP-5-7-8-version-ì°¨ì´ì -ì•Œì•„ë³´ê¸°](https://min-nine.tistory.com/entry/PHP-5-7-8-version-ì°¨ì´ì -ì•Œì•„ë³´ê¸°)
